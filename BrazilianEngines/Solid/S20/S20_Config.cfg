@PART[*]:HAS[#engineType[S20]]:FOR[RealismOverhaulEngines]
{
    %title = S-20 Solid Rocket Motor
    %manufacturer = IAE/Avibras
    %description = O Sonda Trovão Valente é a alma dos foguetes Sonda, direto do calor de Natal! Com variantes S20 e S23, ele é o orgulho do IAE: o S20, com 36 kN de empuxo, é o trovão que leva o Sonda II pros céus ou dá um empurrão como segundo estágio do Sonda III, jogando 20-70 kg a 180 km. Já o S23, mais compacto (1,3 m mais curto), entrega 30 kN e brilha no Sonda III M1, mandando até 300 kg pra 600 km sem fazer o foguete sambar demais. Ambos usam propelente sólido HTPB, tipo um churrasco brasileiro: forte, quente e, se não cuidar, kaboom! O S20 tem ISP 220s (atmosfera)/240s (vácuo), enquanto o S23 sobe pra 230s/250s, porque é econômico como um fusca. Custa 800 fundos (S20) ou 650 (S23), com massa de 0,4 t ou 0,35 t. Aguenta 15 m/s (S20) ou 12 m/s (S23) de impacto – testado na Barreira do Inferno, com o Jeb gritando "bota mais strut!". Cuidado: já tentou fugir pro Atlântico em 69, e o Gene ainda tá bravo com os relatórios.

    @MODULE[ModuleEngines*]
    {
        %EngineType = SolidBooster
    }

    !MODULE[ModuleEngineConfigs],*{}
    !MODULE[ModuleAlternator],*{}
    !RESOURCE,*{}
    !RESOURCE[SolidFuel],*{}

    MODULE
    {
        name = ModuleEngineConfigs
        type = ModuleEngines
        configuration = S20
        modded = false
        origMass = 0.077 // Massa vazia: 77 kg

        CONFIG
        {
            name = S20
            description = "Ó, o S20 Trovão do Sonda é aquele motor que parece que foi feito num fim de semana quente em São José dos Campos, com os engenheiros do IAE gritando 'bota mais propelente sólido aí!' e o Jeb batendo palma. É o cara que dá o gás no Sonda II e faz o papel de segundo estágio no Sonda III, com uns 36 kN de empuxo que jogam 20 a 70 kg de carga útil pra uns 180 km de altura. Tipo, é o foguete que sobe gritando 'Brasil, caramba!' antes de sumir nas nuvens. Ele usa propelente sólido composite, que é basicamente o café expresso dos foguetes: forte, rápido e, se não cuidar, queima tudo. O ISP é 220s na atmosfera e 240s no vácuo – decente pra um bicho que nasceu nos anos 70. Só não esquece de checar o sistema de teledestruição, porque nos primeiros testes, esse danado quis passear pelo Atlântico sem avisar ninguém. Pesa 0,4 t, custa uns 800 fundos (baratinho, né?) e aguenta impacto de 15 m/s – ou seja, cai de bico e ainda sorri. Feito pela IAE/Avibras, com aquele selo 'explode com sotaque nordestino. Cuidado ao acender: ele já fugiu pro mar uma vez. O Jeb achou o máximo, mas o Gene Kerman passou uma semana preenchendo relatórios."
            minThrust = 36
            maxThrust = 36
            heatProduction = 100

            ullage = false
            pressureFed = false
            ignitions = 1

            IGNITOR_RESOURCE
            {
                name = ElectricCharge
                amount = 0.1
            }
            PROPELLANT
            {
                name = HTPB
                ratio = 1.0
                DrawGauge = True
                resourceFlowMode = STACK_PRIORITY_SEARCH
            }
            atmosphereCurve
            {
                key = 0 280
                key = 1 260
            }
            curveResource = HTPB
            %chamberNominalTemp = 2400
            %maxEngineTemp = 2450
            thrustCurve
            {
                key = 1.00000 1.00000   3.74587   0.00000
                key = 0.97950 0.92000  -0.45237   4.07101
                key = 0.94981 0.93333  -0.25725  -0.44590
                key = 0.88444 0.95000  -0.25274  -0.25274
                key = 0.81792 0.96667   0.18451  -0.24838
                key = 0.74616 0.95333   0.00000   0.18709
                key = 0.72579 0.95333   0.65483   0.00000
                key = 0.69557 0.93333   0.66886   0.66886
                key = 0.63705 0.89333   0.46587   0.69880
                key = 0.58066 0.86667   0.45019   0.48020
                key = 0.53193 0.84444   0.46204   0.46204
                key = 0.48447 0.82222   0.47453   0.47453
                key = 0.43827 0.80000   0.41070   0.48771
                key = 0.38492 0.77778   0.42244   0.42243
                key = 0.33306 0.75556   0.43486   0.43486
                key = 0.28271 0.73333   0.51076   0.44804
                key = 0.24409 0.71333   0.35006   0.52508
                key = 0.18160 0.69111   0.36131   0.36131
                key = 0.12108 0.66889   0.37332   0.37331
                key = 0.06254 0.64667   5.88233   0.38614
                key = 0.04840 0.55733   6.82691   6.81961
                key = 0.03636 0.46800   8.13423   8.11931
                key = 0.02641 0.37867  10.06544  10.02963
                key = 0.01856 0.28933  13.22173  13.11034
                key = 0.01282 0.20000   7.80920  18.89608
                key = 0.00890 0.16667   9.37684   9.35696
                key = 0.00570 0.13333  16.18469  11.68894
                key = 0.00249 0.06667  13.87259  30.05728
                key = 0.00062 0.03333  28.14741  25.76339
                key = 0.00000 0.01000   0.00000  68.48464
            }
        }
        MODULE
    {
        name = ModuleEngineConfigs
        type = ModuleEngines
        configuration = S23
        modded = false
        origMass = 0.069 // Massa vazia: 69 kg

        CONFIG
        {
            name = S23
            description = "Olha só o S23 Sondinha Valente, o motor que é tipo o primo menor e mais esperto do S20. Ele nasceu pro Sonda III M1, porque o S20 tava meio grandão e fazia o foguete balançar como se fosse um trio elétrico fora de ritmo. Mais curto em 1,3 metro, esse bichinho entrega uns 30 kN de empuxo e leva cargas de até 300 kg pra 600 km de altitude, tipo 'deixa comigo que eu resolvo'. É perfeito pra segundo estágio, quando você já tá lá em cima e quer mostrar pros kerbals que o Brasil sabe fazer foguete direitinho. O ISP é 230s na atmosfera e 250s no vácuo – econômico como um fusca 1.3. Pesa 0,35 t, custa 650 fundos e aguenta 12 m/s de impacto (porque ele é valente, mas não é de ferro). Em testes reais, ele voou 27 vezes até 2002, mas teve aquela vez que girou tanto que o Bill Kerman jura que viu estrelas antes de apertar o botão de emergência. Feito pela IAE, com amor, suor e um pouco de reza no CLA. Dica: Não deixe o Jeb mexer no controle de atitude. Ele acha que ‘giro’ é sinônimo de ‘diversão’."
            minThrust = 18
            maxThrust = 18
            heatProduction = 100

            ullage = false
            pressureFed = false
            ignitions = 1

            IGNITOR_RESOURCE
            {
                name = ElectricCharge
                amount = 0.1
            }
            PROPELLANT
            {
                name = HTPB
                ratio = 1.0
                DrawGauge = True
                resourceFlowMode = STACK_PRIORITY_SEARCH
            }
            atmosphereCurve
            {
                key = 0 285
                key = 1 265
            }
            curveResource = HTPB
            %chamberNominalTemp = 2400
            %maxEngineTemp = 2450
            thrustCurve
            {
                key = 1.00000 1.00000   3.74587   0.00000
                key = 0.97950 0.92000  -0.45237   4.07101
                key = 0.94981 0.93333  -0.25725  -0.44590
                key = 0.88444 0.95000  -0.25274  -0.25274
                key = 0.81792 0.96667   0.18451  -0.24838
                key = 0.74616 0.95333   0.00000   0.18709
                key = 0.72579 0.95333   0.65483   0.00000
                key = 0.69557 0.93333   0.66886   0.66886
                key = 0.63705 0.89333   0.46587   0.69880
                key = 0.58066 0.86667   0.45019   0.48020
                key = 0.53193 0.84444   0.46204   0.46204
                key = 0.48447 0.82222   0.47453   0.47453
                key = 0.43827 0.80000   0.41070   0.48771
                key = 0.38492 0.77778   0.42244   0.42243
                key = 0.33306 0.75556   0.43486   0.43486
                key = 0.28271 0.73333   0.51076   0.44804
                key = 0.24409 0.71333   0.35006   0.52508
                key = 0.18160 0.69111   0.36131   0.36131
                key = 0.12108 0.66889   0.37332   0.37331
                key = 0.06254 0.64667   5.88233   0.38614
                key = 0.04840 0.55733   6.82691   6.81961
                key = 0.03636 0.46800   8.13423   8.11931
                key = 0.02641 0.37867  10.06544  10.02963
                key = 0.01856 0.28933  13.22173  13.11034
                key = 0.01282 0.20000   7.80920  18.89608
                key = 0.00890 0.16667   9.37684   9.35696
                key = 0.00570 0.13333  16.18469  11.68894
                key = 0.00249 0.06667  13.87259  30.05728
                key = 0.00062 0.03333  28.14741  25.76339
                key = 0.00000 0.01000   0.00000  68.48464
            }
        }
    }

    MODULE
    {
        name = ModuleFuelTanks
        volume = 125.85 // Volume para 7180 kg de HTPB (densidade 1,772 kg/litro)
        type = Solid
        basemass = -1
        TANK
        {
            name = HTPB
            amount = 125.85
            maxAmount = 125.85
        }
    }
}

@PART[*]:HAS[@MODULE[ModuleEngineConfigs]:HAS[@CONFIG[S20]],!MODULE[TestFlightInterop]]:BEFORE[zTestFlight]
{
    TESTFLIGHT
    {
        name = S20
        testedBurnTime = 22 // Margem de segurança
        ratedBurnTime = 20 // Tempo de queima real do S-20
        safeOverburn = true
        ignitionReliabilityStart = 0.780000
        ignitionReliabilityEnd = 0.940000
        ignitionDynPresFailMultiplier = 0.1
        cycleReliabilityStart = 0.880000
        cycleReliabilityEnd = 0.960000
        reliabilityDataRateMultiplier = 1
    }
    @MODULE[ModuleEngineConfigs]
    {
        @CONFIG[S20]
        {
            %ratedBurnTime = #$/TESTFLIGHT[S20]/ratedBurnTime$
        }
    }
}
@PART[*]:HAS[@MODULE[ModuleEngineConfigs]:HAS[@CONFIG[S23]],!MODULE[TestFlightInterop]]:BEFORE[zTestFlight]
{
    TESTFLIGHT
    {
        name = S23
        testedBurnTime = 42 // Margem de segurança
        ratedBurnTime = 28 // Tempo de queima real do S-23
        safeOverburn = true
        ignitionReliabilityStart = 0.800000
        ignitionReliabilityEnd = 0.980000
        ignitionDynPresFailMultiplier = 0.1
        cycleReliabilityStart = 0.920000
        cycleReliabilityEnd = 0.980000
        reliabilityDataRateMultiplier = 1
    }
    @MODULE[ModuleEngineConfigs]
    {
        @CONFIG[S23]
        {
            %ratedBurnTime = #$/TESTFLIGHT[S20]/ratedBurnTime$
        }
    }
}
